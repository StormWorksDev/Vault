<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano AI Assistant</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Fully on-device AI assistant that learns from your text files">
    <meta name="theme-color" content="#3b82f6">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk5hbm8gQUkgQXNzaXN0YW50IiwKICAic2hvcnRfbmFtZSI6ICJOYW5vQUkiLAogICJkZXNjcmlwdGlvbiI6ICJGdWxseSBvbi1kZXZpY2UgQUkgYXNzaXN0YW50IHRoYXQgbGVhcm5zIGZyb20geW91ciB0ZXh0IGZpbGVzIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmOWZhZmIiLAogICJ0aGVtZV9jb2xvciI6ICIjM2I4MmY2IiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhROUlqRXlPQ0luSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUluUGp4eVpXTjBJSGRwWkhSb1BTSXhNamduSUdobGFXZG9kRDBpTVRJNElpQm1hV3hzUFNJak0ySTRNbVkyU0M4K1BIUmxlSFFnZUQwaU5qUWlJSGs5SWpZMElpQm1hV3hzUFNJanptWjJabVlpSUdadmJuUXRjMmw2WlQwaU5EQWlJR1p2Ym5RdGQyVnBaMmgwUFNKaWIyeGtJaUJtYjI1MExXWmhiV2xzZVQwaWJXOXViM053WVdObElpQjBaWGgwTFdGdVkyaHZjajBpYldsa1pHeGxJajVPWVc1dklFRkpQQzkwWlhoMFBqd3ZjM1puUGc9PSIsCiAgICAgICJzaXplcyI6ICIxMjh4MTI4IiwKIAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Custom animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse-dot {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .thinking-dots span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: currentColor;
            animation: pulse-dot 1.4s infinite ease-in-out;
        }
        
        .thinking-dots span:nth-child(1) { animation-delay: -0.32s; }
        .thinking-dots span:nth-child(2) { animation-delay: -0.16s; }
        .thinking-dots span:nth-child(3) { animation-delay: 0; }
        
        /* Scrollbar styling */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>
    
    <!-- Main Container -->
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-4xl mx-auto px-4 py-6">
                <h1 class="text-3xl font-bold text-gray-900">Nano AI Assistant</h1>
                <p class="text-gray-600 mt-2">Your personal AI that learns from your documents - completely offline</p>
            </div>
        </header>
        
        <!-- Tabs -->
        <nav class="bg-white border-b">
            <div class="max-w-4xl mx-auto px-4">
                <div class="flex space-x-8">
                    <button id="chat-tab" class="tab-button active py-4 px-2 border-b-2 border-blue-500 font-medium text-blue-600">
                        Chat
                    </button>
                    <button id="training-tab" class="tab-button py-4 px-2 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700">
                        Training
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="flex-1 max-w-4xl mx-auto w-full px-4">
            <!-- Chat Panel -->
            <div id="chat-panel" class="panel h-full flex flex-col">
                <!-- Messages Area -->
                <div id="messages-container" class="flex-1 overflow-y-auto p-4 custom-scrollbar" style="height: calc(100vh - 200px);">
                    <div id="messages" class="space-y-4 min-h-full">
                        <div class="flex justify-center">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg px-4 py-3 text-blue-700 text-sm max-w-md text-center">
                                <p class="font-medium">Welcome to Nano AI Assistant! ðŸ¤–</p>
                                <p class="mt-1">Upload some text files in the Training tab to get started, then come back here to chat!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Input Area -->
                <div class="border-t bg-white p-4 mt-auto">
                    <div class="flex space-x-3 max-w-4xl mx-auto">
                        <input 
                            type="text" 
                            id="message-input" 
                            placeholder="Ask me anything based on your uploaded documents..."
                            class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500"
                            autocomplete="off"
                        >
                        <button 
                            id="send-button" 
                            class="bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center justify-center min-w-[80px]"
                        >
                            <span>Send</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Training Panel -->
            <div id="training-panel" class="panel hidden p-6 space-y-6">
                <!-- File Upload Area -->
                <div class="bg-white rounded-lg shadow-sm border p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Upload Training Data</h2>
                    
                    <!-- Drag and Drop Zone -->
                    <div 
                        id="drop-zone" 
                        class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors cursor-pointer"
                    >
                        <div class="space-y-2">
                            <svg class="w-12 h-12 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="text-lg text-gray-600">Drop text files here or click to browse</p>
                            <p class="text-sm text-gray-400">Supports .txt files</p>
                        </div>
                        <input type="file" id="file-input" class="hidden" accept=".txt" multiple>
                    </div>
                </div>
                
                <!-- Knowledge Base Stats -->
                <div class="bg-white rounded-lg shadow-sm border p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Knowledge Base</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-blue-50 rounded-lg p-4">
                            <div class="text-2xl font-bold text-blue-600" id="files-count">0</div>
                            <div class="text-sm text-blue-600">Files Loaded</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-4">
                            <div class="text-2xl font-bold text-green-600" id="sentences-count">0</div>
                            <div class="text-sm text-green-600">Sentences</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-4">
                            <div class="text-2xl font-bold text-purple-600" id="keywords-count">0</div>
                            <div class="text-sm text-purple-600">Keywords</div>
                        </div>
                    </div>
                    
                    <button 
                        id="reset-button" 
                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors"
                    >
                        Reset Knowledge Base
                    </button>
                </div>
                
                <!-- File List -->
                <div class="bg-white rounded-lg shadow-sm border p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Uploaded Files</h2>
                    <div id="file-list" class="space-y-2">
                        <p class="text-gray-500 text-sm">No files uploaded yet</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Knowledge Base Class
        class KnowledgeBase {
            constructor() {
                this.sentences = new Map(); // sentence -> {keywords: Set, filename: string}
                this.keywords = new Map(); // keyword -> Set of sentences
                this.files = new Set();
                this.stopWords = new Set([
                    'the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by',
                    'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had', 'do', 'does', 'did',
                    'will', 'would', 'could', 'should', 'may', 'might', 'can', 'must', 'this', 'that', 'these', 'those',
                    'i', 'you', 'he', 'she', 'it', 'we', 'they', 'me', 'him', 'her', 'us', 'them', 'my', 'your', 'his',
                    'her', 'its', 'our', 'their', 'mine', 'yours', 'hers', 'ours', 'theirs', 'what', 'who', 'when',
                    'where', 'why', 'how', 'which', 'whose'
                ]);
                this.loadFromStorage();
            }
            
            // Extract keywords from text
            extractKeywords(text) {
                return new Set(
                    text.toLowerCase()
                        .replace(/[^\w\s]/g, ' ')
                        .split(/\s+/)
                        .filter(word => word.length > 2 && !this.stopWords.has(word))
                );
            }
            
            // Split text into sentences
            splitIntoSentences(text) {
                return text
                    .split(/[.!?]+/)
                    .map(s => s.trim())
                    .filter(s => s.length > 10); // Filter out very short sentences
            }
            
            // Add text to knowledge base
            addText(text, filename) {
                const sentences = this.splitIntoSentences(text);
                this.files.add(filename);
                
                sentences.forEach(sentence => {
                    const keywords = this.extractKeywords(sentence);
                    
                    // Store sentence with its keywords
                    this.sentences.set(sentence, {
                        keywords: keywords,
                        filename: filename
                    });
                    
                    // Index keywords
                    keywords.forEach(keyword => {
                        if (!this.keywords.has(keyword)) {
                            this.keywords.set(keyword, new Set());
                        }
                        this.keywords.get(keyword).add(sentence);
                    });
                });
                
                this.saveToStorage();
            }
            
            // Find relevant sentences for a query
            findRelevantSentences(query, maxResults = 3) {
                const queryKeywords = this.extractKeywords(query);
                const sentenceScores = new Map();
                
                // Score sentences based on keyword overlap
                queryKeywords.forEach(keyword => {
                    if (this.keywords.has(keyword)) {
                        this.keywords.get(keyword).forEach(sentence => {
                            const currentScore = sentenceScores.get(sentence) || 0;
                            sentenceScores.set(sentence, currentScore + 1);
                        });
                    }
                });
                
                // Sort by score and return top results
                return Array.from(sentenceScores.entries())
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, maxResults)
                    .map(([sentence, score]) => ({
                        sentence,
                        score,
                        filename: this.sentences.get(sentence).filename,
                        keywords: this.sentences.get(sentence).keywords
                    }));
            }
            
            // Get statistics
            getStats() {
                return {
                    files: this.files.size,
                    sentences: this.sentences.size,
                    keywords: this.keywords.size
                };
            }
            
            // Reset knowledge base
            reset() {
                this.sentences.clear();
                this.keywords.clear();
                this.files.clear();
                this.saveToStorage();
            }
            
            // Save to localStorage
            saveToStorage() {
                // Check if localStorage is available
                if (typeof Storage === "undefined" || !window.localStorage) {
                    return; // Silently fail if localStorage not available
                }
                
                try {
                    const data = {
                        sentences: Array.from(this.sentences.entries()).map(([sentence, data]) => [
                            sentence, 
                            { 
                                keywords: Array.from(data.keywords || []), 
                                filename: data.filename || 'unknown'
                            }
                        ]),
                        keywords: Array.from(this.keywords.entries()).map(([keyword, sentences]) => [
                            keyword, 
                            Array.from(sentences || [])
                        ]),
                        files: Array.from(this.files || [])
                    };
                    window.localStorage.setItem('nanoai-knowledge', JSON.stringify(data));
                } catch (e) {
                    console.log('Could not save to localStorage - data will not persist');
                }
            }
            
            // Load from localStorage
            loadFromStorage() {
                // Check if localStorage is available
                if (typeof Storage === "undefined" || !window.localStorage) {
                    console.log('localStorage not available - data will not persist');
                    return;
                }
                
                try {
                    const stored = window.localStorage.getItem('nanoai-knowledge');
                    if (!stored || stored === 'null') return; // No data stored yet
                    
                    const data = JSON.parse(stored);
                    
                    if (data && data.sentences) {
                        data.sentences.forEach(([sentence, info]) => {
                            this.sentences.set(sentence, {
                                keywords: new Set(info.keywords || []),
                                filename: info.filename || 'unknown'
                            });
                        });
                    }
                    
                    if (data && data.keywords) {
                        data.keywords.forEach(([keyword, sentences]) => {
                            this.keywords.set(keyword, new Set(sentences || []));
                        });
                    }
                    
                    if (data && data.files) {
                        this.files = new Set(data.files || []);
                    }
                } catch (e) {
                    console.log('Starting with empty knowledge base');
                    // Initialize empty state on error
                    this.sentences.clear();
                    this.keywords.clear();
                    this.files.clear();
                }
            }
        }
        
        // UI Management Class
        class UIManager {
            constructor(knowledgeBase) {
                this.kb = knowledgeBase;
                this.currentPanel = 'chat';
                this.initializeElements();
                this.bindEvents();
                this.updateStats();
                this.updateFileList();
            }
            
            initializeElements() {
                // Tabs
                this.chatTab = document.getElementById('chat-tab');
                this.trainingTab = document.getElementById('training-tab');
                
                // Panels
                this.chatPanel = document.getElementById('chat-panel');
                this.trainingPanel = document.getElementById('training-panel');
                
                // Chat elements
                this.messagesContainer = document.getElementById('messages');
                this.messageInput = document.getElementById('message-input');
                this.sendButton = document.getElementById('send-button');
                
                // Training elements
                this.dropZone = document.getElementById('drop-zone');
                this.fileInput = document.getElementById('file-input');
                this.resetButton = document.getElementById('reset-button');
                
                // Stats
                this.filesCount = document.getElementById('files-count');
                this.sentencesCount = document.getElementById('sentences-count');
                this.keywordsCount = document.getElementById('keywords-count');
                this.fileList = document.getElementById('file-list');
            }
            
            bindEvents() {
                // Tab switching
                this.chatTab.addEventListener('click', () => this.switchPanel('chat'));
                this.trainingTab.addEventListener('click', () => this.switchPanel('training'));
                
                // Chat functionality
                this.sendButton.addEventListener('click', () => this.sendMessage());
                this.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                });
                
                // File upload
                this.dropZone.addEventListener('click', () => this.fileInput.click());
                this.dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.dropZone.classList.add('border-blue-400', 'bg-blue-50');
                });
                this.dropZone.addEventListener('dragleave', () => {
                    this.dropZone.classList.remove('border-blue-400', 'bg-blue-50');
                });
                this.dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.dropZone.classList.remove('border-blue-400', 'bg-blue-50');
                    this.handleFiles(e.dataTransfer.files);
                });
                this.fileInput.addEventListener('change', (e) => {
                    this.handleFiles(e.target.files);
                });
                
                // Reset button
                this.resetButton.addEventListener('click', () => this.resetKnowledgeBase());
            }
            
            switchPanel(panel) {
                // Update tab appearance
                document.querySelectorAll('.tab-button').forEach(tab => {
                    tab.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    tab.classList.add('border-transparent', 'text-gray-500');
                });
                
                if (panel === 'chat') {
                    this.chatTab.classList.add('active', 'border-blue-500', 'text-blue-600');
                    this.chatTab.classList.remove('border-transparent', 'text-gray-500');
                    this.chatPanel.classList.remove('hidden');
                    this.trainingPanel.classList.add('hidden');
                } else {
                    this.trainingTab.classList.add('active', 'border-blue-500', 'text-blue-600');
                    this.trainingTab.classList.remove('border-transparent', 'text-gray-500');
                    this.trainingPanel.classList.remove('hidden');
                    this.chatPanel.classList.add('hidden');
                }
                
                this.currentPanel = panel;
            }
            
            async sendMessage() {
                const message = this.messageInput.value.trim();
                if (!message) return;
                
                // Add user message
                this.addMessage(message, 'user');
                this.messageInput.value = '';
                
                // Show thinking indicator
                const thinkingId = this.addThinkingIndicator();
                
                // Simulate small delay for better UX
                setTimeout(() => {
                    // Remove thinking indicator
                    this.removeThinkingIndicator(thinkingId);
                    
                    // Generate AI response
                    const response = this.generateResponse(message);
                    this.addMessage(response, 'ai');
                }, 500);
            }
            
            generateResponse(query) {
                if (this.kb.sentences.size === 0) {
                    return "I don't have any knowledge yet. Please upload some text files in the Training tab first!";
                }
                
                const results = this.kb.findRelevantSentences(query);
                
                if (results.length === 0) {
                    return "I couldn't find any relevant information in my knowledge base for that query. Try asking about topics covered in your uploaded files.";
                }
                
                // Return the best matching sentence(s)
                if (results.length === 1) {
                    return results[0].sentence;
                } else {
                    return results.map(r => r.sentence).join(' ');
                }
            }
            
            addMessage(content, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'} fade-in`;
                
                const bubble = document.createElement('div');
                bubble.className = `max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${
                    sender === 'user' 
                        ? 'bg-blue-500 text-white' 
                        : 'bg-white border text-gray-800'
                }`;
                bubble.textContent = content;
                
                messageDiv.appendChild(bubble);
                this.messagesContainer.appendChild(messageDiv);
                
                // Scroll to bottom
                this.scrollToBottom();
            }
            
            addThinkingIndicator() {
                const messageDiv = document.createElement('div');
                const thinkingId = 'thinking-' + Date.now();
                messageDiv.id = thinkingId;
                messageDiv.className = 'flex justify-start fade-in';
                
                const bubble = document.createElement('div');
                bubble.className = 'bg-white border text-gray-400 px-4 py-2 rounded-lg';
                bubble.innerHTML = '<div class="thinking-dots"><span></span><span></span><span></span></div>';
                
                messageDiv.appendChild(bubble);
                this.messagesContainer.appendChild(messageDiv);
                this.scrollToBottom();
                
                return thinkingId;
            }
            
            removeThinkingIndicator(thinkingId) {
                const element = document.getElementById(thinkingId);
                if (element) {
                    element.remove();
                }
            }
            
            scrollToBottom() {
                const container = document.getElementById('messages-container');
                container.scrollTop = container.scrollHeight;
            }
            
            async handleFiles(files) {
                for (const file of files) {
                    if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                        try {
                            const text = await this.readFileAsText(file);
                            this.kb.addText(text, file.name);
                            this.showToast(`Loaded: ${file.name}`, 'success');
                        } catch (error) {
                            this.showToast(`Error loading ${file.name}: ${error.message}`, 'error');
                        }
                    } else {
                        this.showToast(`Skipped ${file.name}: Only .txt files are supported`, 'warning');
                    }
                }
                
                this.updateStats();
                this.updateFileList();
            }
            
            readFileAsText(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.onerror = e => reject(new Error('Failed to read file'));
                    reader.readAsText(file);
                });
            }
            
            updateStats() {
                const stats = this.kb.getStats();
                this.filesCount.textContent = stats.files;
                this.sentencesCount.textContent = stats.sentences;
                this.keywordsCount.textContent = stats.keywords;
            }
            
            updateFileList() {
                const files = Array.from(this.kb.files);
                
                if (files.length === 0) {
                    this.fileList.innerHTML = '<p class="text-gray-500 text-sm">No files uploaded yet</p>';
                } else {
                    this.fileList.innerHTML = files.map(filename => `
                        <div class="flex items-center space-x-2 p-2 bg-gray-50 rounded">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"/>
                            </svg>
                            <span class="text-sm text-gray-700">${filename}</span>
                        </div>
                    `).join('');
                }
            }
            
            resetKnowledgeBase() {
                if (confirm('Are you sure you want to reset the knowledge base? This will delete all uploaded data.')) {
                    this.kb.reset();
                    this.updateStats();
                    this.updateFileList();
                    this.showToast('Knowledge base reset successfully', 'success');
                    
                    // Clear chat messages
                    this.messagesContainer.innerHTML = `
                        <div class="flex justify-center">
                            <div class="bg-gray-100 rounded-lg px-4 py-2 text-gray-600 text-sm">
                                Upload some text files in the Training tab to get started!
                            </div>
                        </div>
                    `;
                }
            }
            
            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `px-4 py-2 rounded-lg text-white font-medium fade-in ${
                    type === 'success' ? 'bg-green-500' : 
                    type === 'error' ? 'bg-red-500' : 
                    type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
                }`;
                toast.textContent = message;
                
                const container = document.getElementById('toast-container');
                container.appendChild(toast);
                
                // Auto remove after 3 seconds
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(100%)';
                    setTimeout(() => container.removeChild(toast), 300);
                }, 3000);
            }
        }
        
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
            window.addEventListener('load', () => {
                // Simple service worker registration for HTTPS environments
                navigator.serviceWorker.register('/sw.js').catch(() => {
                    console.log('Service worker not available - app will work without PWA features');
                });
            });
        } else if ('serviceWorker' in navigator && window.location.protocol === 'file:') {
            // For file:// protocol (local development), skip service worker
            console.log('PWA features disabled for file:// protocol');
        }
        
        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            const knowledgeBase = new KnowledgeBase();
            const ui = new UIManager(knowledgeBase);
            
            // Add install prompt for PWA
            let deferredPrompt;
            
            window.addEventListener('beforeinstallprompt', (e) => {
                // Only show install prompt on supported environments
                if (window.location.protocol !== 'https:') return;
                
                e.preventDefault();
                deferredPrompt = e;
                
                // Show install button
                const installButton = document.createElement('button');
                installButton.textContent = 'Install App';
                installButton.className = 'fixed bottom-4 right-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium shadow-lg transition-colors z-40';
                installButton.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`User response to the install prompt: ${outcome}`);
                        deferredPrompt = null;
                        installButton.remove();
                    }
                });
                document.body.appendChild(installButton);
            });
        });
    </script>
</body>
</html>
  
